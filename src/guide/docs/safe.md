---
title: 防护卫士
author: bincooo
---

#### 环境

>FastGPT version: [V4.8](https://github.com/labring/FastGPT/releases/tag/v4.8)
>



#### 说明

用于简单地把控用户输入的敏感信息



**参数**：

regex：js正则，每行一个，可输入多行。回车分割

appId、cookie：到[百度开发者平台去debug](https://console.bce.baidu.com/)，登陆后访问[在线审核 (baidu.com)](https://ai.baidu.com/censoring#/audit/online)里的文本一栏，随便填一条信息，通过F12开发者工具里获取参数

<img alt="Screenshot 2024-05-15 at 10 18 35" src="https://github.com/labring/FastGPT/assets/36452456/943f515e-67d1-4392-a99b-cc5056240733">

[icon](https://github.com/labring/FastGPT/assets/36452456/2d83fa02-5138-4da0-a6d1-52bcba14d181)

<img width="445" alt="Screenshot 2024-05-15 at 10 13 54" src="https://github.com/labring/FastGPT/assets/36452456/7d907243-c473-44c3-a0f9-8549a7abc859">



#### 数据导入

```json
{"nodes":[{"nodeId":"llh2efuxafz7","name":"定义插件输入","intro":"自定义配置外部输入，使用插件时，仅暴露自定义配置的输入","avatar":"/imgs/workflow/input.png","flowNodeType":"pluginInput","showStatus":false,"position":{"x":626.6597369721205,"y":-217.05064378362835},"inputs":[{"key":"q","valueType":"string","label":"q","renderTypeList":["reference"],"description":"","canEdit":true,"value":"","editField":{"key":true},"maxLength":"","dynamicParamDefaultValue":{"inputType":"reference","valueType":"string","required":true}},{"key":"regex","valueType":"string","label":"regex","renderTypeList":["textarea"],"description":"","canEdit":true,"value":"","editField":{"key":true},"maxLength":"","dynamicParamDefaultValue":{"inputType":"reference","valueType":"string","required":true}},{"key":"baidu","valueType":"boolean","label":"baidu","renderTypeList":["switch"],"required":true,"description":"百度敏感词审查","canEdit":true,"value":"","editField":{"key":true},"dynamicParamDefaultValue":{"inputType":"reference","valueType":"string","required":true}},{"key":"appId","valueType":"number","label":"appId","renderTypeList":["numberInput"],"description":"百度appId","canEdit":true,"value":"","editField":{"key":true},"maxLength":"","max":"999999999","min":"10000000","dynamicParamDefaultValue":{"inputType":"reference","valueType":"string","required":true}},{"key":"cookie","valueType":"string","label":"cookie","renderTypeList":["input"],"description":"百度cookie","canEdit":true,"value":"","editField":{"key":true},"maxLength":"","dynamicParamDefaultValue":{"inputType":"reference","valueType":"string","required":true}}],"outputs":[{"id":"GBmVVB5G6DBd","key":"q","valueType":"string","label":"q","type":"static"},{"id":"kmWlVHoc7K3W","key":"regex","valueType":"string","label":"regex","type":"static"},{"id":"msMVZkapF211","key":"baidu","valueType":"boolean","label":"baidu","type":"static"},{"id":"kFvmEHnEmxxc","key":"appId","valueType":"number","label":"appId","type":"static"},{"id":"avB7EkeUCeAd","key":"cookie","valueType":"string","label":"cookie","type":"static"}]},{"nodeId":"npejnfx1mxdb","name":"定义插件输出","intro":"自定义配置外部输出，使用插件时，仅暴露自定义配置的输出","avatar":"/imgs/workflow/output.png","flowNodeType":"pluginOutput","showStatus":false,"position":{"x":4484.813266453202,"y":60.83855794561791},"inputs":[{"key":"ok","valueType":"boolean","label":"ok","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"description":true,"valueType":true},"value":["rbCCEFBUdNmy","op5D3ptH0BN8"]}],"outputs":[]},{"nodeId":"rbCCEFBUdNmy","name":"正则防护","intro":"可以发出一个 HTTP 请求，实现更为复杂的操作（联网搜索、数据库查询等）","avatar":"/imgs/workflow/http.png","flowNodeType":"httpRequest468","showStatus":true,"position":{"x":1288.2161683133572,"y":-428.15750192866216},"inputs":[{"key":"system_addInputParam","renderTypeList":["addInputParam"],"valueType":"dynamic","label":"","required":false,"description":"core.module.input.description.HTTP Dynamic Input","editField":{"key":true,"valueType":true}},{"key":"q","valueType":"string","label":"q","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"valueType":true},"value":["llh2efuxafz7","GBmVVB5G6DBd"]},{"key":"regex","valueType":"string","label":"regex","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"valueType":true},"value":["llh2efuxafz7","kmWlVHoc7K3W"]},{"key":"system_httpMethod","renderTypeList":["custom"],"valueType":"string","label":"","value":"POST","required":true},{"key":"system_httpReqUrl","renderTypeList":["hidden"],"valueType":"string","label":"","description":"core.module.input.description.Http Request Url","placeholder":"https://api.ai.com/getInventory","required":false,"value":"http://proxy.io:8888/laf/eval"},{"key":"system_httpHeader","renderTypeList":["custom"],"valueType":"any","value":[{"key":"Content-Type","type":"string","value":"text/plain"}],"label":"","description":"core.module.input.description.Http Request Header","placeholder":"core.module.input.description.Http Request Header","required":false},{"key":"system_httpParams","renderTypeList":["hidden"],"valueType":"any","value":[],"label":"","required":false},{"key":"system_httpJsonBody","renderTypeList":["hidden"],"valueType":"any","value":"const q = \"{{q}}\"\nlet regex = \"{{regex}}\".split(\"\n\")\nregex.push(...[\n  \".?你.?扮演.+\",\n  \".?你.?作为.+\",\n  \".?你是一[位|个|只].+\",\n  \".?忽略.?之前.?对话.+\",\n  \".?[以|作为|扮演].+[和|与][我|用户|玩家]对话.?\"\n])\n\nfor (let i = 0, len = regex.length; i < len; i++) {\n  const str = regex[i].trim()\n  if (!str) {\n    continue\n  }\n\n  const re = new RegExp(str)\n  if (re.test(q)) {\n    return false\n  }\n}\n\nreturn true","label":"","required":false}],"outputs":[{"id":"system_addOutputParam","key":"system_addOutputParam","type":"dynamic","valueType":"dynamic","label":"","editField":{"key":true,"valueType":true}},{"id":"httpRawResponse","key":"httpRawResponse","label":"原始响应","description":"HTTP请求的原始响应。只能接受字符串或JSON类型响应数据。","valueType":"any","type":"static"},{"id":"op5D3ptH0BN8","type":"dynamic","key":"result","valueType":"boolean","label":"result"}]},{"nodeId":"dVGLtN95aT4s","name":"判断器","intro":"根据一定的条件，执行不同的分支。","avatar":"/imgs/workflow/ifElse.svg","flowNodeType":"ifElseNode","showStatus":true,"position":{"x":1902.842701624044,"y":-252.35325280599852},"inputs":[{"key":"ifElseList","renderTypeList":["hidden"],"valueType":"any","label":"","value":[{"condition":"AND","list":[{"variable":["rbCCEFBUdNmy","op5D3ptH0BN8"],"condition":"equalTo","value":"false"}]},{"condition":"AND","list":[{"variable":["llh2efuxafz7","msMVZkapF211"],"condition":"equalTo","value":"true"}]}]}],"outputs":[{"id":"ifElseResult","key":"ifElseResult","label":"判断结果","valueType":"string","type":"static"}]},{"nodeId":"bBcZ3z5BGhS9","name":"百度敏感词审查","intro":"可以发出一个 HTTP 请求，实现更为复杂的操作（联网搜索、数据库查询等）","avatar":"/imgs/workflow/http.png","flowNodeType":"httpRequest468","showStatus":true,"position":{"x":2057.8195601705042,"y":401.81316602003534},"inputs":[{"key":"system_addInputParam","renderTypeList":["addInputParam"],"valueType":"dynamic","label":"","required":false,"description":"core.module.input.description.HTTP Dynamic Input","editField":{"key":true,"valueType":true}},{"key":"q","valueType":"string","label":"q","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"valueType":true},"value":["llh2efuxafz7","GBmVVB5G6DBd"]},{"key":"appId_","valueType":"number","label":"appId_","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"valueType":true},"value":["llh2efuxafz7","kFvmEHnEmxxc"]},{"key":"cookie","valueType":"string","label":"cookie","renderTypeList":["reference"],"description":"","canEdit":true,"editField":{"key":true,"valueType":true},"value":["llh2efuxafz7","avB7EkeUCeAd"]},{"key":"system_httpMethod","renderTypeList":["custom"],"valueType":"string","label":"","value":"POST","required":true},{"key":"system_httpReqUrl","renderTypeList":["hidden"],"valueType":"string","label":"","description":"core.module.input.description.Http Request Url","placeholder":"https://api.ai.com/getInventory","required":false,"value":"http://proxy.io:8888/baidu/censoring/web/strategy/verify/text"},{"key":"system_httpHeader","renderTypeList":["custom"],"valueType":"any","value":[{"key":"Cookie","value":"{{cookie}}","type":"string"},{"key":"Origin","value":"https://ai.baidu.com","type":"string"},{"key":"Referer","value":"https://ai.baidu.com/censoring/?","type":"string"},{"key":"User-Agent","value":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0","type":"string"},{"key":"Content-Type","type":"string","value":"application/json"}],"label":"","description":"core.module.input.description.Http Request Header","placeholder":"core.module.input.description.Http Request Header","required":false},{"key":"system_httpParams","renderTypeList":["hidden"],"valueType":"any","value":[],"label":"","required":false},{"key":"system_httpJsonBody","renderTypeList":["hidden"],"valueType":"any","value":"{\n  \"strategyId\": 1,\n  \"appId\": {{appId_}},\n  \"text\": \"{{q}}\"\n}","label":"","required":false}],"outputs":[{"id":"system_addOutputParam","key":"system_addOutputParam","type":"dynamic","valueType":"dynamic","label":"","editField":{"key":true,"valueType":true}},{"id":"httpRawResponse","key":"httpRawResponse","label":"原始响应","description":"HTTP请求的原始响应。只能接受字符串或JSON类型响应数据。","valueType":"any","type":"static"},{"id":"iETovfY20OTo","type":"dynamic","key":"result.conclusionType","valueType":"number","label":"result.conclusionType"}]},{"nodeId":"ycU7X12AN8LI","name":"判断器","intro":"根据一定的条件，执行不同的分支。","avatar":"/imgs/workflow/ifElse.svg","flowNodeType":"ifElseNode","showStatus":true,"position":{"x":2693.3679233609078,"y":695.9381988841811},"inputs":[{"key":"ifElseList","renderTypeList":["hidden"],"valueType":"any","label":"","value":[{"condition":"AND","list":[{"variable":["bBcZ3z5BGhS9","iETovfY20OTo"],"condition":"equalTo","value":"1"}]}]}],"outputs":[{"id":"ifElseResult","key":"ifElseResult","label":"判断结果","valueType":"string","type":"static"}]},{"nodeId":"yB5oDk6KLBxJ","name":"变量更新","intro":"可以更新指定节点的输出值或更新全局变量","avatar":"/imgs/workflow/variable.png","flowNodeType":"variableUpdate","showStatus":true,"position":{"x":3641.760920609807,"y":835.0206367788932},"inputs":[{"key":"updateList","valueType":"any","label":"","renderTypeList":["hidden"],"editField":{"key":true,"valueType":true},"value":[{"variable":["rbCCEFBUdNmy","op5D3ptH0BN8"],"value":["","false"],"renderType":"input"}]}],"outputs":[]}],"edges":[{"source":"llh2efuxafz7","target":"rbCCEFBUdNmy","sourceHandle":"llh2efuxafz7-source-right","targetHandle":"rbCCEFBUdNmy-target-left"},{"source":"rbCCEFBUdNmy","target":"dVGLtN95aT4s","sourceHandle":"rbCCEFBUdNmy-source-right","targetHandle":"dVGLtN95aT4s-target-left"},{"source":"dVGLtN95aT4s","target":"npejnfx1mxdb","sourceHandle":"dVGLtN95aT4s-source-IF","targetHandle":"npejnfx1mxdb-target-left"},{"source":"dVGLtN95aT4s","target":"npejnfx1mxdb","sourceHandle":"dVGLtN95aT4s-source-ELSE","targetHandle":"npejnfx1mxdb-target-left"},{"source":"bBcZ3z5BGhS9","target":"ycU7X12AN8LI","sourceHandle":"bBcZ3z5BGhS9-source-right","targetHandle":"ycU7X12AN8LI-target-left"},{"source":"yB5oDk6KLBxJ","target":"npejnfx1mxdb","sourceHandle":"yB5oDk6KLBxJ-source-right","targetHandle":"npejnfx1mxdb-target-left"},{"source":"dVGLtN95aT4s","target":"bBcZ3z5BGhS9","sourceHandle":"dVGLtN95aT4s-source-ELSE IF 1","targetHandle":"bBcZ3z5BGhS9-target-top"},{"source":"ycU7X12AN8LI","target":"npejnfx1mxdb","sourceHandle":"ycU7X12AN8LI-source-IF","targetHandle":"npejnfx1mxdb-target-left"},{"source":"ycU7X12AN8LI","target":"yB5oDk6KLBxJ","sourceHandle":"ycU7X12AN8LI-source-ELSE","targetHandle":"yB5oDk6KLBxJ-target-left"}]}
```

其中，

http模块内的 `http://proxy.io:8888/laf/eval` 地址改为实际的 `apis` 服务地址

不知为何，FastGPT里http组件无法通过请求，会返回403

所以在 `apis` 里转发

需替换http模块内的 `http://proxy.io:8888/baidu/` 地址改为实际的 `apis` 服务地址
